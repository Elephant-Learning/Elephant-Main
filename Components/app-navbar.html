<style>
    #desktop-navbar{
        background:linear-gradient(135deg, var(--dark-gray) 0%, var(--light-gray) 40%, var(--dark-gray) 60%);
        display:flex;
        flex-direction:row;
        align-items:center;
        height:calc(var(--size) * 48px);
        position:absolute;
        width:100vw;
        top:0;
        left:0;
    }

    #desktop-main-image, .desktop-navbar-right-img{
        width:calc(var(--size) * 48px);
        height:calc(var(--size) * 48px);
        display:flex;
        flex-direction:row;
        align-items:center;
        justify-content:center;
        border-right:1px solid var(--dark-border-color);
    }

    #desktop-main-image > a > img, #desktop-main-image > div > img{
        width:calc(var(--size) * 28px);
        padding-top: 3px;
        cursor:pointer;
    }

    #desktop-input-div{
        margin:0 calc(var(--size) * 12px);
        display:flex;
        flex-direction:row;
        align-items:center;
        background:var(--light-gray);
        overflow:hidden;
        border-radius:calc(var(--size) * 5px);
        transition-duration:250ms;
    }

    #desktop-input-div:hover{
        background:var(--dark-border-color);
    }

    #desktop-input-img{
        width:calc(var(--size) * 18px);
        filter:invert(1);
        padding:0 calc(var(--size) * 6px);
    }

    #desktop-navbar-input{
        height:calc(var(--size) * 30px);
        background:transparent;
        border:none;
        width:calc(var(--size) * 256px);
        font-size:calc(var(--size) * 12px);
        outline:none;
        color:white;
        padding-right:calc(var(--size) * 12px);
    }

    #desktop-navbar-right{
        position:absolute;
        right:0;
        display:flex;
        flex-direction:row;
        align-items:center;
        gap:calc(var(--size) * 12px);
    }

    .desktop-navbar-right-img{
        width:calc(var(--size) * 24px);
        position:relative;
        border:none;
    }

    .desktop-navbar-right-img > img{
        width:calc(var(--size) * 18px);
        filter:invert(1);
        cursor:pointer;
    }

    .desktop-navbar-right-img > div{
        background:linear-gradient(135deg, var(--primary-accent), var(--primary-accent-gradient));
        width:calc(var(--size) * 8px);
        height:calc(var(--size) * 8px);
        border-radius:50%;
        position:absolute;
        top:calc(var(--size) * 10px);
        right:calc(var(--size) * 0px)
    }

    #desktop-navbar-profile{
        display:flex;
        flex-direction:row;
        align-items:center;
        padding:0 calc(var(--size) * 12px);
        transition-duration:250ms;
        height:calc(var(--size) * 48px);
        border-left:1px solid var(--dark-border-color);
        width:calc(var(--size) * 176px);
    }

    #desktop-navbar-profile:hover{
        background:var(--hover-dark);
    }

    #desktop-navbar-profile-image {
        height: calc(var(--size) * 24px);
        margin-right:calc(var(--size) * 12px);
    }

    #navbar-profile-text > h1{
        font-size:calc(var(--size) * 12px);
        font-weight:500;
        cursor:default;
        color:white;
        margin:0;
    }

    #navbar-profile-text > p{
        font-size:calc(var(--size) * 10px);
        font-weight:300;
        color:lightgray;
        cursor:default;
        width:auto;
        margin:0;
    }

    #desktop-navbar-profile > img:last-of-type{
        filter:invert(1);
        height:calc(var(--size) * 16px);
        margin:0 calc(var(--size) * 6px);
        position:absolute;
        right:0;
    }

    #desktop-navbar-profile > div:last-of-type{
        visibility: hidden;
        opacity:0;
        transition-duration:250ms;
        transition-delay:125ms;
    }

    #desktop-navbar-profile:hover > div:last-of-type{
        visibility:visible;
        opacity:1;
    }

    #desktop-profile-modal, .profile-sub-modal{
        position:absolute;
        z-index:4;
        width:calc(var(--size) * 194px);
        border-radius:calc(var(--size) * 6px);
        background:var(--dark-gray);
        padding:calc(var(--size) * 12px) 0;
        display:flex;
        flex-direction:column;
        align-items:center;
        transition-duration:250ms;
    }

    #desktop-profile-modal::before{
        content:'';
        width: 0;
        height: 0;
        border-left: calc(var(--size) * 8px) solid transparent;
        border-right: calc(var(--size) * 8px) solid transparent;
        border-bottom: calc(var(--size) * 6px) solid var(--dark-gray);
        position:absolute;
        top:calc(var(--size) * -6px);
        right:calc(var(--size) * 150px);
    }

    #desktop-profile-modal{
        right:calc(var(--size) * 8px);
        top:calc(var(--size) * 56px);
        opacity:1;
        visibility:visible;
    }

    .profile-sub-modal{
        left:calc(var(--size) * -202px);
        top:0;
    }

    #desktop-profile-modal > div:not(.profile-break), .profile-sub-modal > div, #desktop-profile-modal > a{
        display:flex;
        flex-direction:row;
        justify-content:flex-start;
        gap:calc(var(--size) * 12px);
        align-items:flex-start;
        padding:calc(var(--size) * 6px) calc(var(--size) * 12px);
        transition-duration:125ms;
        width:calc(100% - var(--size) * 24px);
        position:relative;
        cursor:pointer;
    }

    #desktop-profile-modal > div:not(.profile-break) > .profile-sub-modal{
        visibility:hidden;
        transition-delay:125ms;
        opacity:0;
    }

    #desktop-profile-modal > div:not(.profile-break):hover, .profile-sub-modal > div:hover, #desktop-profile-modal > a:hover{
        background:var(--primary-accent);
    }

    #desktop-profile-modal > div:not(.profile-break):hover > .profile-sub-modal{
        visibility: visible;
        opacity:1;
    }

    #desktop-profile-modal > div:not(.profile-break) > img:first-of-type, .profile-sub-modal > div > img:first-of-type, #desktop-profile-modal > a > img{
        height:calc(var(--size) * 17px);
        filter:invert(1);
    }

    #desktop-profile-modal > div:not(.profile-break) > img:nth-of-type(2), .profile-sub-modal > div > img:nth-of-type(2){
        position:absolute;
        right:calc(var(--size) * 12px);
        height:calc(var(--size) * 16px);
        filter:invert(1);
    }

    #desktop-profile-modal > div:not(.profile-break) > p, .profile-sub-modal > div > p, #desktop-profile-modal > a > p{
        font-size:calc(var(--size) * 13px);
        cursor:pointer;
        margin:0;
        font-weight:400;
        color:white;
    }

    #desktop-profile-modal > a{
        text-decoration:none;
    }

    .profile-break{
        width:calc(100% - var(--size) * 24px);
        height:1px;
        background:var(--dark-border-color);
        margin:calc(var(--size) * 6px) 0
    }

    #desktop-profile-modal > button{
        width:calc(100% - var(--size) * 24px);
        height:calc(var(--size) * 24px);
        background:var(--dark-border-color);
        border:none;
        outline:none;
        border-radius:calc(var(--size) * 6px);
        text-transform:uppercase;
        transition-duration:250ms;
        color:white;
        font-weight:500;
        font-size:calc(var(--size) * 13px);
        letter-spacing:1px;
        cursor:pointer;
    }

    #desktop-profile-modal > button:hover{
        background:var(--primary-accent);
    }

    .desktop-modal{
        position:absolute;
        background:var(--bg-color-1);
        border:1px solid var(--light-border-color);
        transition-duration:500ms;
        padding:calc(var(--size) * 24px);
        border-radius:calc(var(--size) * 16px);
        width:calc(var(--size) * 320px);
        display:flex;
        flex-direction:column;
        align-items:flex-start;
        justify-content:flex-start;
        gap:calc(var(--size) * 6px);
        z-index:2;
        cursor:default;
    }

    .inactive-modal{
        visibility:hidden;
        opacity:0;
    }

    .desktop-modal-image-container{
        width:calc(var(--size) * 64px);
        height:calc(var(--size) * 64px);
        margin-bottom:calc(var(--size) * 16px);
        background:linear-gradient(135deg, var(--primary-accent), var(--primary-accent-gradient));
        border-radius:50%;
        display:flex;
        flex-direction:row;
        align-items:center;
        justify-content:center;
    }

    .desktop-modal-image-container > img{
        height:calc(var(--size) * 42px);
        position:absolute;
        left:calc(var(--size) * 36px);
        filter:invert(1);
    }

    .desktop-modal > h1{
        margin:0;
        font-size:calc(var(--size) * 16px);
    }

    .desktop-modal > p{
        font-size:calc(var(--size) * 12px);
        margin: 0 0 calc(var(--size) * 12px);
        color:gray;
    }

    .desktop-modal > h6{
        font-size:calc(var(--size) * 12px);
        font-weight:600;
        margin: calc(var(--size) * 6px) 0 0;
    }

    .desktop-modal-input-container{
        display:flex;
        flex-direction:row;
        align-items:center;
        justify-content:space-between;
        width:calc(var(--size) * 296px);
        padding:0 calc(var(--size) * 12px);
        border:1px solid var(--light-border-color);
        border-radius:calc(var(--size) * 6px);
    }

    .desktop-modal-input-container > img{
        height:calc(var(--size) * 18px);
        filter:invert(0.5);
    }

    .desktop-modal-input-container > input{
        width:calc(var(--size) * 268px);
        height:calc(var(--size) * 32px);
        color:gray;
        font-size:calc(var(--size) * 12px);
        outline:none;
        border:none;
        background:transparent;
    }

    .desktop-modal-buttons-container{
        width:calc(var(--size) * 320px);
        margin-top:calc(var(--size) * 6px);
        display:flex;
        flex-direction:row;
        justify-content:space-between;
        align-items:center;
    }

    .desktop-modal-buttons-container > button{
        width:47.5%;
        border:none;
        outline:none;
        font-size:calc(var(--size) * 14px);
        text-transform:uppercase;
        letter-spacing:1px;
        border-radius:calc(var(--size) * 12px);
        transition-duration:250ms;
        cursor:pointer;
    }

    .desktop-modal-buttons-container > button:first-of-type{
        background:transparent;
        padding:calc(var(--size) * 11px) 0;
        border:1px solid gray;
    }

    .desktop-modal-buttons-container > button:last-of-type{
        color:white;
        padding:calc(var(--size) * 12px) 0;
        background:linear-gradient(135deg, var(--primary-accent), var(--primary-accent-gradient));
    }

    .desktop-modal-buttons-container > button:first-of-type:hover:not(.desktop-modal-buttons-container > button:active), .desktop-modal-buttons-container > button:first-of-type:hover:not(.desktop-modal-buttons-container > button:active){
        box-shadow:0 0 calc(var(--size) * 12px) 0 gray;
    }

    .desktop-modal-buttons-container > button:last-of-type:hover:not(.desktop-modal-buttons-container > button:active), .desktop-modal-buttons-container > button:last-of-type:hover:not(.desktop-modal-buttons-container > button:active){
        box-shadow:0 0 calc(var(--size) * 12px) 0 var(--primary-accent);
    }

    .desktop-modal-buttons-container > button:active, .desktop-modal-buttons-container > button:active{
        box-shadow:none;
    }
</style>
<div id="desktop-navbar">
    <div id="desktop-main-image">
        <a href="../"><img src="../icons/elephant-400-400-white.png" alt="Elephant Logo"></a>
    </div>
    <div id="desktop-input-div">
        <img src="../flip/icons/search.png" alt="Search" id="desktop-input-img">
        <input type="text" id="desktop-navbar-input" placeholder="Search Items, Users, Classrooms">
    </div>
    <div id="desktop-navbar-right">
        <div class="desktop-navbar-right-img" onclick="toggleFriendingModal(false)" id="desktop-navbar-friending-container">
            <img src="../flip/icons/add_friend.png" alt="Friend Request">
        </div>
        <div class="desktop-navbar-right-img" onclick="toggleNotificationsModal()" id="desktop-navbar-notifications-container">
            <img src="../flip/icons/notification.png" alt="Notifications" id="notifications-btn">
        </div>
        <div id="desktop-navbar-profile">
            <img src="../icons/avatars/47.png" alt="Image" id="desktop-navbar-profile-image">
            <div id="navbar-profile-text">
                <h1 id="desktop-navbar-profile-name">Login / Sign Up</h1>
                <p id="desktop-navbar-profile-type">Unlock More With Login</p>
            </div>
            <img src="../flip/icons/expand_down.png" alt="Dropdown">
            <div id="desktop-profile-modal" class="active-modal">
                <a href="../profile/" id="your-profile-btn">
                    <img src="../flip/icons/emojis/happy.png" id="desktop-profile-user-img" alt="">
                    <p>Your Profile</p>
                </a>
                <div>
                    <img src="../flip/icons/theme.png" alt="">
                    <p>Theme</p>
                    <img src="../flip/icons/expand-right.png" alt="">
                    <div class="profile-sub-modal">
                        <div onclick="toggleTheme(0)">
                            <img src="../flip/icons/sun.png" alt="">
                            <p>Light Theme</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-theme-check-img">
                        </div>
                        <div onclick="toggleTheme(1)">
                            <img src="../flip/icons/moon.png" alt="">
                            <p>Dark Theme</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-theme-check-img">
                        </div>
                        <div onclick="toggleTheme(2)">
                            <img src="../flip/icons/50%25.png" alt="">
                            <p>System Default</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-theme-check-img">
                        </div>
                    </div>
                </div>
                <div>
                    <img src="../flip/icons/zoom.png">
                    <p>Accessibility Zoom</p>
                    <img src="../flip/icons/expand-right.png" alt="">
                    <div class="profile-sub-modal">
                        <div onclick="toggleSizeSetting(0)">
                            <img src="../flip/icons/zoom_out.png" alt="">
                            <p>75%</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-zoom-check-img">
                        </div>
                        <div onclick="toggleSizeSetting(1)">
                            <img src="../flip/icons/search.png" alt="">
                            <p>100%</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-zoom-check-img">
                        </div>
                        <div onclick="toggleSizeSetting(2)">
                            <img src="../flip/icons/zoom_in.png" alt="">
                            <p>125%</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-zoom-check-img">
                        </div>
                        <div onclick="toggleSizeSetting(3)">
                            <img src="../flip/icons/zoom_in.png" alt="">
                            <p>150%</p>
                            <img src="../flip/icons/check.png" alt="" class="profile-zoom-check-img">
                        </div>
                    </div>
                </div>
                <div class="profile-break"></div>
                <div onclick="localStorage.removeItem('savedUserId'); location.href = '../login'">
                    <img src="../flip/icons/logout.png" id="logout-btn-img">
                    <img src="../flip/icons/login.png" alt="login-btn-img">
                    <p id="login-logout-btn-txt">Log Out</p>
                </div>
                <!--<button>Get Premium</button>-->
            </div>
        </div>
    </div>
</div>
<div id="desktop-friending-modal" class="inactive-modal desktop-modal">
    <div id="friending-main-image-container" class="desktop-modal-image-container">
        <img src="../flip/icons/add_friend.png" alt="" id="friending-main-image">
    </div>
    <h1>Add Friends</h1>
    <p>Use Elephant to the fullest along with your study buddies to get the most out of Elephant!</p>
    <h6>Friend Email Addresses</h6>
    <div id="friending-input-container" class="desktop-modal-input-container">
        <img src="../flip/icons/email.png" alt="">
        <input type="text" id="friending-input">
    </div>
    <div id="friending-buttons" class="desktop-modal-buttons-container">
        <button id="friending-cancel" onclick="toggleFriendingModal(false)">Cancel</button>
        <button id="friending-done" onclick="toggleFriendingModal(true)">Send</button>
    </div>
</div>
<script>
    function toggleTheme(themeIndex){
        let root = document.querySelector(":root");

        if(themeIndex === 0){
            root.style.setProperty('--text-color', 'black');
            root.style.setProperty("--bg-color-1", "#ffffff");
            root.style.setProperty("--bg-color-2", "#f6f7fb")
            root.style.setProperty("--light-border-color", "#eaecf0");
            root.style.setProperty("--dark-border-color", "#21262d");
            root.style.setProperty("--dark-gray", "black");
            root.style.setProperty("--light-gray", "#010409");
            root.style.setProperty("--hover-dark", "#16171a");
            root.style.setProperty("--hover-light", "#f5f5f5");
            root.style.setProperty("--image-invert", "0");
            root.style.setProperty("--light-accent", "#fdeefa");
            root.style.setProperty("--primary-accent", "#fe599d");
            root.style.setProperty("--primary-accent-gradient", "#fe599d");
            root.style.setProperty("--secondary-accent", "#00a8ff");
            root.style.setProperty("--secondary-accent-gradient", "#00a8ff");
            root.style.setProperty("--light-secondary", "#edf9fe");
            root.style.setProperty("--tertiary-accent", "#f8680a");
            root.style.setProperty("--tertiary-accent-gradient", "#f8680a");
            root.style.setProperty("--light-tertiary", "#fefaed");
            root.style.setProperty("--light-quaternary", "#fdeefd");
            root.style.setProperty("--quaternary-accent", "#e100ff");
            root.style.setProperty("--quaternary-accent-gradient", "#e100ff");
        } else if(themeIndex === 1){
            root.style.setProperty('--text-color', 'white');
            root.style.setProperty("--bg-color-1", "#161b22");
            root.style.setProperty("--bg-color-2", "#0d1117")
            root.style.setProperty("--light-border-color", "#21262d");
            root.style.setProperty("--dark-border-color", "#21262d");
            root.style.setProperty("--dark-gray", "black");
            root.style.setProperty("--light-gray", "#010409");
            root.style.setProperty("--hover-dark", "#16171a");
            root.style.setProperty("--hover-light", "#171717");
            root.style.setProperty("--image-invert", "0.75");
            root.style.setProperty("--light-accent", "#30363d");
            root.style.setProperty("--primary-accent", "#e32b78");
            root.style.setProperty("--primary-accent-gradient", "#b11074");
            root.style.setProperty("--light-secondary", "#30363d");
            root.style.setProperty("--secondary-accent", "#0d87c5");
            root.style.setProperty("--secondary-accent-gradient", "#27b4b9");
            root.style.setProperty("--tertiary-accent", "#db7735");
            root.style.setProperty("--tertiary-accent-gradient", "#d47d39");
            root.style.setProperty("--light-tertiary", "#30363d");
            root.style.setProperty("--light-quaternary", "#30363d");
            root.style.setProperty("--quaternary-accent", "#9a0bad");
            root.style.setProperty("--quaternary-accent-gradient", "#6609c3");

        } else if(themeIndex === 2){
            root.style.setProperty('--text-color', 'black');
            root.style.setProperty("--bg-color-1", "#ffffff");
            root.style.setProperty("--bg-color-2", "#f6f7fb")
            root.style.setProperty("--light-border-color", "#eaecf0");
            root.style.setProperty("--dark-border-color", "#21262d");
            root.style.setProperty("--dark-gray", "black");
            root.style.setProperty("--light-gray", "#010409");
            root.style.setProperty("--hover-dark", "#16171a");
            root.style.setProperty("--hover-light", "#f5f5f5");
            root.style.setProperty("--image-invert", "0");
            root.style.setProperty("--light-accent", "#fdeefa");
            root.style.setProperty("--primary-accent", "#fe599d");
            root.style.setProperty("--primary-accent-gradient", "#f30096");
            root.style.setProperty("--secondary-accent", "#00a8ff");
            root.style.setProperty("--secondary-accent-gradient", "#31d6dc");
            root.style.setProperty("--light-secondary", "#edf9fe");
            root.style.setProperty("--tertiary-accent", "#f8680a");
            root.style.setProperty("--tertiary-accent-gradient", "#fa8d37");
            root.style.setProperty("--light-tertiary", "#fefaed");
            root.style.setProperty("--light-quaternary", "#fdeefd");
            root.style.setProperty("--quaternary-accent", "#e100ff");
            root.style.setProperty("--quaternary-accent-gradient", "#7f00ff");
        } else if(themeIndex === 3){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) toggleTheme(1);
            else toggleTheme(0)
        }

        document.querySelectorAll('.profile-theme-check-img').forEach(function(element){
            element.classList.add('inactive-modal');
        })

        document.querySelectorAll('.profile-theme-check-img')[themeIndex].classList.remove('inactive-modal');

        let preferences = JSON.parse(localStorage.getItem('preferences'));
        preferences[0] = themeIndex;
        localStorage.setItem('preferences', JSON.stringify(preferences));
    }

    function toTitleCase(str) {
        return str.toLowerCase().split(/[- .]+/).map(function (word) {
            return (word.charAt(0).toUpperCase() + word.slice(1));
        }).join(' ');
    }

    function toggleSizeSetting(value){
        const sizes = [0.75, 1, 1.25, 1.5];
        let preferences = JSON.parse(localStorage.getItem('preferences'));

        document.querySelector(':root').style.setProperty('--size', sizes[value].toString());

        document.querySelectorAll('.profile-zoom-check-img').forEach(function(element){
            element.classList.add('inactive-modal');
        })

        document.querySelectorAll('.profile-zoom-check-img')[value].classList.remove('inactive-modal');

        preferences[1] = value;
        localStorage.setItem('preferences', JSON.stringify(preferences));
    }

    function dateToObject(DATE){
        const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

        let endingDate = "th";
        let endingTime = "AM"

        if(DATE.getHours() > 11) {
            endingTime = "PM";
            if(DATE.getHours() > 12) DATE.setHours(DATE.getHours() - 12);
        }
        if(DATE.getHours() === 0) DATE.setHours(12);

        let refactoredMinutes;

        if(DATE.getMinutes().toString().length === 1) refactoredMinutes = "0" + DATE.getMinutes().toString();
        else refactoredMinutes = DATE.getMinutes().toString();

        if(DATE.getDate() > 20 || DATE.getDate < 4){
            if(DATE.getDate() & 10 === 1) endingDate = "st";
            if(DATE.getDate() & 10 === 2) endingDate = "nd";
            if(DATE.getDate() & 10 === 3) endingDate = "rd";
        }

        return {
            month: months[DATE.getMonth()],
            date: DATE.getDate(),
            dateEnding: endingDate,
            year: DATE.getFullYear(),
            hour: DATE.getHours(),
            minutes: refactoredMinutes,
            timeEnding: endingTime
        }
    }


    async function friendUser(friending, friendId, notificationId){
        const savedUserId = JSON.parse(localStorage.getItem('savedUserId'));

        if(friending){
            const friendingResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/friends/add', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Methods': 'PUT, DELETE, POST, GET, OPTIONS',
                    'Access-Control-Allow-Headers': 'Content-Type'
                },
                body: JSON.stringify({
                    userId: savedUserId,
                    friendId: friendId
                }),
                mode: 'cors'
            })

            const friendingContext = await friendingResponse.json();
            console.log(friendingContext);
        }

        const notificationDeletionResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/notifications/delete?id=' + notificationId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            mode: 'cors'
        })

        const notificationDeletionContext = await notificationDeletionResponse.json();
        console.log(notificationDeletionContext);

        const userResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + savedUserId, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            mode: 'cors'
        })

        const userContext = await userResponse.json()

        await notificationsManager(userContext.context.user);
    }

    async function initNavbar(user){
        if(user === null){
            document.getElementById("your-profile-btn").remove();
            document.getElementById("logout-btn-img").remove();
            document.getElementById("login-logout-btn-txt").innerHTML = "Log In";

            document.getElementById("desktop-navbar-notifications-container").remove();
            document.getElementById("desktop-navbar-friending-container").remove();

            return;
        }

        document.getElementById('desktop-navbar-profile-image').src = "../../icons/avatars/" + user.pfpId + ".png";
        document.getElementById('desktop-navbar-profile-name').innerHTML = user.firstName + " " + user.lastName;
        document.getElementById('desktop-navbar-profile-type').innerHTML = "Elephant " + user.type.charAt(0).toUpperCase() + user.type.substr(1).toLowerCase();
        document.getElementById("login-btn-img").remove();

        await notificationsManager(user);
        toggleNotificationTab(0);

        await displayFlashcardsManager(user);
    }

    async function toggleFriendingModal(send){
        if(document.getElementById('desktop-friending-modal').classList.contains('inactive-modal')){
            document.getElementById('friending-input').value = "";
            document.getElementById('desktop-friending-modal').classList.remove('inactive-modal')
        } else {
            if(send){
                const response = await fetch('https://elephantsuite-rearend.herokuapp.com/login/userByEmail?email=' + document.getElementById('friending-input').value, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                        'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                        'Access-Control-Allow-Headers': 'Content-Type'
                    },
                    mode: 'cors'
                })

                const context = await response.json();
                console.log(context);

                if(context.status === "SUCCESS"){
                    const savedUserId = JSON.parse(localStorage.getItem('savedUserId'));
                    const userResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + savedUserId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        mode: 'cors'
                    })

                    const userContext = await userResponse.json();

                    const notificationResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/notifications/sendFriendRequest', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        body: JSON.stringify({
                            type: "FRIEND_REQUEST",
                            message: userContext.context.user.firstName + " " + userContext.context.user.lastName + " sent you a friend request!",
                            senderId: userContext.context.user.id,
                            recipientId: context.context.user.id
                        }),
                        mode: 'cors'
                    })

                    const notificationContext = await notificationResponse.json();
                    console.log(notificationContext);
                }
            } document.getElementById('desktop-friending-modal').classList.add('inactive-modal');
        }
    }

    function removeAllChildNodes(parent) {
        while(parent.firstChild) {
            parent.removeChild(parent.firstChild);
        }
    }

    async function refreshNotifications(){
        const savedUserId = JSON.parse(localStorage.getItem('savedUserId'));
        const response = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + savedUserId, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            mode: 'cors'
        })

        const context = await response.json();
        await notificationsManager(context.context.user);

        let activeNotificationsTab = 0;
        let notificationsTabIncrement = 0;

        document.querySelectorAll('.desktop-notifications-tab').forEach(function(element){
            console.log(element.classList, notificationsTabIncrement);
            if(element.classList.contains('active-notifications-tab')) {
                activeNotificationsTab = notificationsTabIncrement;
            }
            notificationsTabIncrement++;
        });

        console.log(activeNotificationsTab);
        toggleNotificationTab(activeNotificationsTab);
    }

    async function notificationsManager(user){

        document.querySelectorAll('.desktop-notifications-list').forEach(function(element){
            removeAllChildNodes(element);
        })

        document.querySelectorAll('.desktop-notifications-tab-number').forEach(function(element){
            element.innerHTML = "0";
        })

        try{
            document.getElementById("desktop-notification-icon").remove();
        } catch{

        }

        for(let i = 0; i < user.notifications.length; i++){
            if(user.notifications[i].type === "FRIEND_REQUEST"){
                try{
                    const response = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + user.notifications[i].senderId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        mode: 'cors'
                    })

                    const context = await response.json();

                    createNotification("friend", {
                        name: context.context.user.firstName + " " + context.context.user.lastName,
                        pfpId: context.context.user.pfpId,
                        senderId: user.notifications[i].senderId,
                        time: user.notifications[i].time,
                        notificationId: user.notifications[i].id
                    })
                } catch(e){

                }
            } else if(user.notifications[i].type === "SHARED_DECK"){
                try{
                    const responseCreator = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + user.notifications[i].senderId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        mode: 'cors'
                    })

                    const contextCreator = await responseCreator.json();

                    const responseDeck = await fetch('https://elephantsuite-rearend.herokuapp.com/deck/get?id=' + user.notifications[i].deckId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        mode: 'cors'
                    })

                    const contextDeck = await responseDeck.json();

                    createNotification("deckShared", {
                        sender: contextCreator.context.user.firstName + " " + contextCreator.context.user.lastName,
                        deckName: contextDeck.context.deck.name,
                        deckId: user.notifications[i].deckId,
                        time: user.notifications[i].time,
                        pfpId: contextCreator.context.user.pfpId,
                        notificationId: user.notifications[i].id
                    })
                } catch(e){}
            } else if(user.notifications[i].type === "ANSWER_ANSWER"){
                try{
                    const response = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + user.notifications[i].senderId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Access-Control-Allow-Origin': '*',
                            'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                            'Access-Control-Allow-Headers': 'Content-Type'
                        },
                        mode: 'cors'
                    })

                    const context = await response.json();

                    createNotification("questionAnswered", {
                        name: context.context.user.firstName + " " + context.context.user.lastName,
                        pfpId: context.context.user.pfpId,
                        senderId: user.notifications[i].senderId,
                        time: user.notifications[i].time,
                        questionName: user.notifications[i].message,
                        questionId: user.notifications[i].answerId,
                        commentId: user.notifications[i].commentId,
                        notificationId: user.notifications[i].id
                    })
                } catch(e){
                    console.log("Error")
                }
            }
        }

        if(user.notifications.length > 0){
            let newDiv = document.createElement('div');
            newDiv.id = "desktop-notification-icon"
            document.getElementById('desktop-navbar-notifications-container').appendChild(newDiv);
        }
    }

    function timeToText(date){
        let month = ["January","February","March","April","May","June","July", "August","September","October","November","December"];
        let AMPM = "A.M.";
        let dateHours = date.getHours();
        let dateMinutes = date.getMinutes();
        let dateDay = date.getDate();

        if(dateHours === 0) dateHours += 12;
        else if(dateHours >= 12){
            AMPM = "P.M."
            if(dateHours > 12){
                dateHours -= 12;
            }
        }

        if(dateMinutes < 10){
            dateMinutes = "0" + dateMinutes;
        } if(dateDay < 10){
            dateDay = "0" + dateDay;
        }

        return month[date.getMonth()] + " " + dateDay + ", " + date.getFullYear() + " at " + dateHours + ":" + dateMinutes + " " + AMPM;
    }

    function computeTime(time){
        let splitTime = time.split('-');
        let timing = splitTime[2].split(':');
        let originalDate = new Date(Date.UTC(splitTime[0], splitTime[1] - 1, timing[0].substring(0, 2), timing[0].slice(-2), timing[1]));

        return timeToText(originalDate);
    }

    document.getElementById("desktop-navbar-input").addEventListener("keypress", function(e){
        if (e.key === "Enter") {
            e.preventDefault();
            let content = document.getElementById("desktop-navbar-input").value;

            content = content.replaceAll(" ", "+");
            location.href = `../search/?query=${content}`;
        }
    });

    async function addDeckShared(deckID, adding, notificationId){
        const savedUserId = JSON.parse(localStorage.getItem('savedUserId'));

        if(adding){
            const response = await fetch('https://elephantsuite-rearend.herokuapp.com/deck/shareDeck', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                    'Access-Control-Allow-Headers': 'Content-Type'
                },
                body: JSON.stringify({
                    deckId: deckID,
                    sharedUserId: savedUserId
                }),
                mode: 'cors'
            })

            const context = await response.json();
            console.log(context);
        }

        const notificationDeletionResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/notifications/delete?id=' + notificationId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            mode: 'cors'
        })

        const notificationDeletionContext = await notificationDeletionResponse.json();
        console.log(notificationDeletionContext);

        if(adding){
            location.href = "../viewer/?deck=" + deckID;
        } else {
            const userResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/login/user?id=' + savedUserId, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                    'Access-Control-Allow-Headers': 'Content-Type'
                },
                mode: 'cors'
            })

            const userContext = await userResponse.json()

            notificationsManager(userContext.context.user);
        }
    }

    async function viewComment(questionId, commentId, notificationId, view){
        const userResponse = await fetch('https://elephantsuite-rearend.herokuapp.com/notifications/delete?id=' + notificationId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            mode: 'cors'
        })

        const userContext = await userResponse.json();
        console.log(userContext);

        if(view) location.href = `../../ask/question/?id=${questionId}`;
    }

    function createNotification(TYPE, DATA){
        let newDiv = document.createElement('div');
        let unreadDiv = document.createElement('div');
        let avatarDiv = document.createElement('div');
        let avatar = document.createElement('img');
        let textDiv = document.createElement('div');
        let timeDiv = document.createElement('p');
        let optionsDiv = document.createElement('div');

        let parentDiv;

        avatar.src = "../../icons/avatars/" + DATA.pfpId + ".png";
        avatarDiv.appendChild(avatar);

        timeDiv.innerHTML = computeTime(DATA.time);

        if(TYPE === "friend"){
            let header = document.createElement('h1');
            let span1 = document.createElement('span');
            let btn1 = document.createElement('button');
            let btn2 = document.createElement('button');

            span1.classList.add('bolded');
            span1.innerHTML = DATA.name;

            header.append(span1, document.createTextNode(" would like to be your friend."));

            btn1.innerHTML = "Accept";
            btn2.innerHTML = "Decline";
            btn1.classList.add('desktop-notification-btn-1');
            btn2.classList.add('desktop-notification-btn-2');
            btn1.setAttribute("onclick", "friendUser(true, " + DATA.senderId + ", " + DATA.notificationId + ")")
            btn2.setAttribute("onclick", "friendUser(false, undefined, " + DATA.notificationId + ")")

            optionsDiv.append(btn1, btn2);
            optionsDiv.classList.add('desktop-notification-options');

            textDiv.append(header, timeDiv, optionsDiv);

            parentDiv = document.querySelectorAll('.desktop-notifications-list')[1];

            document.querySelectorAll('.desktop-notifications-tab-number')[1].innerHTML = (parseInt(document.querySelectorAll('.desktop-notifications-tab-number')[1].textContent) + 1).toString();

        } else if(TYPE === "deckShared"){
            let header = document.createElement('h1');
            let span1 = document.createElement('span');
            let span2 = document.createElement('span');
            let btn1 = document.createElement('button');
            let btn2 = document.createElement('button');

            span1.classList.add('bolded')
            span2.classList.add('bolded')
            span1.innerHTML = DATA.sender;
            span2.innerHTML = DATA.deckName;

            header.append(span1, document.createTextNode(" wants to share "), span2, document.createTextNode(" with you."));

            btn1.innerHTML = "Accept";
            btn2.innerHTML = "Decline";
            btn1.classList.add('desktop-notification-btn-1');
            btn2.classList.add('desktop-notification-btn-2');
            btn1.setAttribute("onclick", "addDeckShared(" + DATA.deckId + ", true, " + DATA.notificationId + ")")
            btn2.setAttribute("onclick", "addDeckShared(" + DATA.deckId + ", false, " + DATA.notificationId + ")")

            optionsDiv.append(btn1, btn2);
            optionsDiv.classList.add('desktop-notification-options');

            textDiv.append(header, timeDiv, optionsDiv);

            parentDiv = document.querySelectorAll('.desktop-notifications-list')[0];

            document.querySelectorAll('.desktop-notifications-tab-number')[0].innerHTML = (parseInt(document.querySelectorAll('.desktop-notifications-tab-number')[0].textContent) + 1).toString();
        } else if(TYPE === "deckFavorited"){
            let header = document.createElement('h1');
            let span1 = document.createElement('span');
            let span2 = document.createElement('span');

            span1.classList.add('bolded')
            span2.classList.add('bolded')
            span1.innerHTML = DATA.sender;
            span2.innerHTML = DATA.deckName;

            header.append(span1, document.createTextNode(" favorited your deck, "), span2, document.createTextNode("."));

            textDiv.append(header, timeDiv);

            parentDiv = document.querySelectorAll('.desktop-notifications-list')[0];

            document.querySelectorAll('.desktop-notifications-tab-number')[0].innerHTML = (parseInt(document.querySelectorAll('.desktop-notifications-tab-number')[0].textContent) + 1).toString();
        } else if(TYPE === "questionAnswered"){
            let header = document.createElement('h1');
            let span1 = document.createElement('span');
            let span2 = document.createElement('span');
            let btn1 = document.createElement('button');
            let btn2 = document.createElement('button');

            span1.classList.add('bolded')
            span2.classList.add('bolded')
            span1.innerHTML = DATA.name;
            span2.innerHTML = DATA.questionName;

            btn1.innerHTML = "View";
            btn2.innerHTML = "Delete";
            btn1.classList.add('desktop-notification-btn-1');
            btn2.classList.add('desktop-notification-btn-2');

            btn1.addEventListener("click", function(e){
                viewComment(DATA.questionId, DATA.commentId, DATA.notificationId, true);
            });

            btn2.addEventListener("click", function(e){
                viewComment(DATA.questionId, DATA.commentId, DATA.notificationId, false);
                newDiv.remove();
            });

            header.append(span1, document.createTextNode(" commented on your question, "), span2, document.createTextNode("."));

            optionsDiv.append(btn1, btn2);
            optionsDiv.classList.add('desktop-notification-options');

            textDiv.append(header, timeDiv, optionsDiv);

            parentDiv = document.querySelectorAll('.desktop-notifications-list')[0];

            document.querySelectorAll('.desktop-notifications-tab-number')[0].innerHTML = (parseInt(document.querySelectorAll('.desktop-notifications-tab-number')[0].textContent) + 1).toString();
        }

        newDiv.append(unreadDiv, avatarDiv, textDiv);
        newDiv.classList.add('desktop-notification')

        parentDiv.appendChild(newDiv);
    }

    function toggleNotificationsModal(){
        if(document.getElementById('desktop-notifications-modal').classList.contains('inactive-modal')){
            document.getElementById('desktop-notifications-modal').classList.remove('inactive-modal');
        } else {
            document.getElementById('desktop-notifications-modal').classList.add('inactive-modal')
        }
    }

    function toggleNotificationTab(index){
        document.querySelector(".active-notifications-tab").classList.remove('active-notifications-tab');
        document.querySelectorAll('.desktop-notifications-tab')[index].classList.add('active-notifications-tab');

        document.querySelector('.active-notifications-list').classList.remove('active-notifications-list');

        if(document.querySelectorAll('.desktop-notifications-list')[index].hasChildNodes()){
            document.querySelectorAll('.desktop-notifications-list')[index].classList.add('active-notifications-list');
        } else {
            document.getElementById('no-notifications').classList.add('active-notifications-list');
        }
    }

    function mainInitialize(){
        let preferences = localStorage.getItem('preferences');

        if(!preferences) {
            localStorage.setItem('preferences', JSON.stringify([2, 1, 0]));
            preferences = localStorage.getItem('preferences');
        }

        preferences = JSON.parse(preferences);

        if(!(preferences[0] < 3)) {
            preferences = [2, preferences[1], preferences[2]];
        }

        if(!(preferences[1] < 4)) {
            preferences = [preferences[0], 1, preferences[2]];
        }

        if(!(preferences[2] < 2)){
            preferences = [preferences[0], preferences[1], 0];
        }

        toggleTheme(preferences[0]);
        toggleSizeSetting(preferences[1]);

        let index = 1;

        document.querySelectorAll(".sidebar-dropdown").forEach(function(elem){
            elem.children[0].addEventListener("click", function(e){
                if(elem.classList.contains("active-sidebar-dropdown")){
                    elem.classList.remove("active-sidebar-dropdown");
                } else {
                    elem.classList.add("active-sidebar-dropdown");
                }
            });

            elem.classList.add("active-sidebar-dropdown");
        })

        //initializeMusic();

        localStorage.setItem('preferences', JSON.stringify(preferences));
    }

    function toggleModal(modal){
        if(modal.classList.contains('inactive-modal')){
            modal.classList.remove('inactive-modal');
        } else {
            modal.classList.add('inactive-modal');
        }
    }

    function toggleMusicModal(){
        toggleModal(document.getElementById("music-modal"));
    }

    mainInitialize()
</script>